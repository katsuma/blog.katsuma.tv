---
title: Amazon S3を導入してみました
date: 2007/11/21 00:57:25
tags: web20
published: true

---

<p><a href="http://www.flickr.com/photos/katsuma/2049921009/" title="Amazon S3 by katsuma, on Flickr"><img src="http://farm3.static.flickr.com/2041/2049921009_e076687dd1_m.jpg" border="0" alt="Amazon S3" width="240" height="135" /></a></p>  <p> 前回のエントリーの通り、KayacさんがS3を導入していると知ってから、社内の開発陣の中で空前のS3ブーム？があったわけですが、実際に導入をしてみました。ちょっと迷う箇所もあるのでS3導入メモを残しておきます。 </p>

<h3>Amazon Web Serviceアカウントを取得する</h3>  <p>何はともあれ、AWS（Amazon Web Service）のアカウントを取得する必要があります。<a href="http://www.amazonaws.com">AWSトップページ</a>にアクセスして、右のメニューの「Sign-up today」からアカウントを取得します。 アカウント取得にあたってはメールアドレス、パスワード、住所、クレジットカードなどの項目が要求されます。一点、パスワードが簡単なものだと「それじゃダメだ」と怒られるので注意です。アカウントが取得できたら、確認メールが送られるので内容を確認します。</p>     <h3>AccessKeyの取得</h3> <p>次にS3ストレージにアクセスするためのAccessKeyを取得します。<a href="http://www.amazonaws.com">AWSトップページ</a>にアクセスすると、ログインした状態であれば右のメニューに「Your Web Services Account」なるボタンがあるので、ここにカーソルをあわせます。するとメニューがポップアップで表示されるので、<strike>「View Access Key Identifiers」</strike>「<span><span class="n2Pop" style="display: none; visibility: visible; left: 1087px; top: 177px"><a href="http://aws-portal.amazon.com/gp/aws/developer/account/index.html/002-3472366-3426414?ie=UTF8&amp;action=access-key">AWS Access Identifiers</a>                          </span></span><span><span class="n2Pop" style="display: none; visibility: visible; left: 1087px; top: 177px"><a href="http://aws-portal.amazon.com/gp/aws/developer/account/index.html/002-3472366-3426414?ie=UTF8&amp;action=access-key">AWS Access Identifiers</a>                          </span></span><span><span class="n2Pop" style="display: inline; visibility: visible; left: 1087px; top: 177px">AWS Access Identifiers</span></span>」(2007/11/21 12:06修正) から「Access Key」と「Securet Key」を取得することができます。</p>  <h3>クライアントのインストール</h3> <p>S3へのアクセスはWebサービスなので、HTTPのGET,PUT,DELETEでファイルを扱うことになるのですが、さすがにそれは面倒すぎるので便利なクライアントを利用することにします。ここではFirefoxのアドオンで<a href="https://addons.mozilla.org/ja/firefox/addons/versions/3247">S3 Firefox Organizer</a>なるものがあるのでこれを利用します。これは簡単に言うとS3専用のFFFTPのようなもので、GUIのシンプルな操作でS3へのファイル操作、パーミッションの変更などを可能にします。</p>    <p>S3 Firefox Organizerをインストールすると、Firefox右下に「S3FOX」のロゴが表示されていると思います。ここをクリック、または「ツール」＞「S3 Organizer」を選択することでS3 Firefox Organizerを起動することができます。起動後は、まず「Manage Accounts」を選択し、「AccessKey」および「Securet Key」を入力します。ここでのKeyの値は上で取得したものを利用します。ここで右下のロゴから起動していると、AccessKeyのCopy&amp;Pasteがやや面倒な作りになっているので（Overlayの問題？）ご注意。「ツール」からたどる起動方法をお勧めします。</p>  <p>AccessKeyを入力すると、FTPクライアントのような画面が出ると思います。画面左がローカル、右があちら側の世界、つまりS3のストレージ領域です。</p>   <h3>バケット</h3> <p>まずは「バケット」と呼ばれるフォルダのようなものを作成します。ここで作成したバケットはファイルアクセスのためのURLにも利用されます。たとえば僕は「katsuma」というバケットを作成しましたが、これによって<strong>「http://s3.amazonaws.com/katsuma/*」</strong>というURLでアクセスが可能になります。</p>  <p>ちなみにバケット名はドメインのようなもので、早いもの勝ちです。バケット作成時に誰かがすでに同じ名前のバケットを作成していると、作成時にエラーがでるので要注意です。僕は「katsuma」取ったんで、利用するときはここにファイルをつっこんでいこうと思います。</p>  <h3>ファイルアップロード</h3> <p>ファイルをS3に上げるときは、見たままのとおりローカル側からファイルを選択してS3側へD&amp;DすればOKです。</p>    <p>ここでポイントとして、デフォルトではアップロードされたファイルはアップロードした「自分自身」のみがアクセス可能となっています。誰でもアクセス可能にするには、「ファイルを選択」＞「右クリック」＞「Edit ACL」から「Everyone」の「Read」にチェックを入れれば、ブラウザからアクセスできるかと思います。</p>    <p>また、ファイルの転送量に対して課金対象となっているので、ファイルの移動はもちろん、名前変更も課金対象となるので要注意です。（GET&rarr;名前を変えてPUT&rarr;DELETE）。サイズの大きなサイズはあらかじめ配置場所や名前なんかの計画を立てておいたほうがベターかもしれません。</p>    <h3>とはいえ、やっぱ安い</h3> <p>テスト的に<a href="http://s3.amazonaws.com/katsuma/gacha.jpg">ガチャピンの画像</a>をuploadしてみましたが、こんなものだと$0.03のまま変化せず、（当然のごとく）全然安いです。個人的なファイルのやりとりなんかをするのももちろん、ビジネスにも利用するのもそりゃ検討材料になるな、と実感させられます。（とか言いつつ、商用利用についてはまだちゃんと調べきれてません。多分OK？）</p>    <h3>DDOS攻撃てどうなの？</h3>  <p>CTOと話していて思ったのですが、これDDOS攻撃についてはどうなるんでしょう？悪意を持ったユーザならS3上のリソースに対して簡単なShellScriptで「無限ダウンローダ」とか作れちゃいます。当然のごとくGETについての転送量も課金されるので、（以下略）な展開も考えられるわけで。</p>   <p>これについてはちょっと調べたところでは回避方法はわかりませんでした。GETのAPIを組み合わせてうまい認証機構をリソース提供側で用意しろって話なんでしょうか？？（どなたかご存知の方がいらっしゃったら教えていただきたいです。）</p>  <h3>結論</h3>   <p>S3凄い便利。DDOSに対する懸念はあるけども、そういうのを無視してもお釣りがくるほど凄いサービスですよ。ストレージで困っている企業やサービスはいい加減導入を検討すべきかと。S3++</p>  <p>なお、今回のS3の導入は<a href="http://www.misuzilla.org/~mayuki/misc/AmazonS3">こちらのサイト</a>を参考にさせていただきました。有益な情報ありがとうございました。</p>
